<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车结算</title>
    <link href="../css/payforgoods.css" type="text/css" rel="stylesheet">
    <link href="../css/wrap.css" type="text/css" rel="stylesheet">
</head>
<body>
    <div class="box">
        <ul class="banner">
            <li class="banner1">电话咨询
                <div class="banner1-b">
                    <img src="../images/call.png">
                    <span>100-100-100</span>
                </div>
            </li>
            <li class="banner2">关注我们
                <div class="banner2-b">
                    <img src="../images/wx_03.gif">
                </div>
            </li>
            <li class="banner3">在线咨询</li>
            <li class="banner4"><a href="#top">返回顶部</a></li>
        </ul>
        <div class="header-box">
            <header>
                <div class="header-left">
                    <i></i>
                    <span>全场免运费</span>
                </div>
                <div class="header-right">
                    <div class="header-car">
                        <i></i>
                        <span></span>
                    </div>
                    <div class="usermsg">
                        <a href="#">登录/注册</a>
                    </div>
                </div>
            </header>
        </div>
        <div class="middle-box">
            <div class="middle" id="#top">
                <h1>
                    <img src="../images/logo.png">
                </h1>
                <!-- <div class="nav">
                    <div class="nav-left">
                        <ul>
                            <li><a href="#">首页</a></li>
                            <li class="skin"><a href="#">护肤</a>
                                <div class="menu">
                                    <div class="menu1">
                                        <div class="menu1-top"><span>按系列</span></div>
                                            <ul class="menu1-ul">
                                                <li>
                                                    <a href="#"><img src="../images/18.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/6.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/24.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/13.jpg"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/14.png"></a>
                                                </li>
                                                <li>
                                                   <a href="#"> <img src="../images/25.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/22.jpg"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/11.jpg"></a>
                                                </li>
                                                <li>
                                                    <a href="#"> <img src="../images/1.jpg"></a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="menu2">
                                            <div class="menu2-top"><span>按种类</span></div>
                                            <ul class="menu2-ul">
                                                <li><a href="#">卸妆清洁</a></li>
                                                <li><a href="#">爽肤水</a></li>
                                                <li><a href="#">精华</a></li>
                                                <li><a href="#">乳液</a></li>
                                                <li><a href="#">面霜</a></li>
                                                <li><a href="#">眼唇护理</a></li>
                                                <li><a href="#">面膜</a></li>
                                                <li><a href="#">护肤套装</a></li>
                                            </ul>
                                        </div>
                                        <div class="menu3">
                                            <div class="menu3-top"><span>按关心问题</span></div>
                                            <ul class="menu3-ul">
                                                <li><a href="#">干燥缺水</a></li>
                                                <li><a href="#">色斑暗沉</a></li>
                                                <li><a href="#">轻熟肌 弹性流失</a></li>
                                                <li><a href="#">熟龄肌 深度老化</a></li>
                                                <li><a href="#">毛孔粗大</a></li>
                                                <li><a href="#">眼周松弛</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                                <li class="makeup"><a href="#">彩妆</a>
                                    <div class="make">
                                        <div class="make1">
                                            <div class="make1-top"><span>按系列</span></div>
                                            <ul class="make1-ul">
                                                <li><a href="#"><img src="../images/9.jpg"></a></li>
                                                <li><a href="#"><img src="../images/eye.jpg"></a></li>
                                                <li><a href="#"><img src="../images/17.jpg"></a></li>
                                                <li><a href="#"><img src="../images/20.jpg"></a></li>
                                            </ul>
                                        </div>
                                        <div class="make2">
                                            <div class="make2-top"><span>面部</span></div>
                                            <ul class="make2-ul">
                                                <li><a href="#">妆前乳</a></li>
                                                <li><a href="#">粉底液</a></li>
                                                <li><a href="#">遮瑕</a></li>
                                                <li><a href="#">蜜粉</a></li>
                                                <li><a href="#">腮红</a></li>
                                            </ul>
                                        </div>
                                        <div class="make3">
                                            <div class="make3-top"><span>眼部</span></div>
                                            <ul class="make3-ul">
                                                <li><a href="#">眼影</a></li>
                                                <li><a href="#">眼线</a></li>
                                                <li><a href="#">睫毛膏</a></li>
                                                <li><a href="#">眉笔</a></li>
                                            </ul>
                                        </div>
                                        <div class="make4">
                                            <div class="make4-top"><span>唇部</span></div>
                                            <ul class="make4-ul">
                                                <li><a href="#">唇膏</a></li>
                                                <li><a href="#">唇线</a></li>
                                            </ul>
                                        </div>
                                        <div class="make5">
                                            <div class="make5-top"><span>彩妆其他</span></div>
                                            <ul class="make5-ul">
                                                <li><a href="#">粉盒</a></li>
                                                <li><a href="#">刷子</a></li>
                                                <li><a href="#">工具</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                                <li><a href="#">男士</a></li>
                                <li><a href="#">防晒</a></li>
                                <li><a href="#">香氛</a></li>
                                <li class="nine"><a href="#">官网臻享</a></li>
                                <li class="nine"><a href="#">明星产品</a></li>
                                <li class="nine"><a href="#">官网购物理由</a></li>
                                <li class="nine"><a href="#">品牌故事</a></li>
                                <li class="nine"><a href="#">专柜导航</a></li>
                            </ul>
                    </div>
                    <div class="nav-right">
                        <input type="text" id="search" placeholder="商品搜索">
                        <a href="#"><i></i></a>
                    </div>
                </div> -->
                <div class="pro">
                    <ul>
                        <li class="current">
                            <span>购物车</span>
                            <i></i>
                        </li>
                        <li>
                            <span>订单信息</span>
                            <i></i>
                        </li>
                        <li>
                            <span>确认及付款</span>
                            <i></i>
                        </li>
                        <li>
                            <span>完成</span>
                        </li>
                    </ul>
                </div>
                <div class="table">
                    <ul class="th">
                        <li class="goodsname">商品</li>
                        <li class="goodsprice">单价(元)</li>
                        <li class="goodsnum">数量</li>
                        <li class="sum">小计</li>
                        <li class="active">操作</li>
                    </ul>
                    <ul class="tbody">
                        <!-- <li>
                            <div class="x-name">
                                <img src="../images/3.jpg">
                                <span>快捷导航的数据库护肤的空间撒</span>
                            </div>
                            <div class="x-price">￥5555</div>
                            <div class="x-num">
                                <span class="reduce">-</span>
                                <span class="num">555</span>
                                <span class="add">+</span>
                            </div>
                            <div class="x-sum">￥8888</div>
                            <div class="x-active">
                                <i></i>
                                <span>删除</span>
                            </div>
                        </li> -->
                        <!-- <li>
                            <div class="x-name">
                                <img src="../images/3.jpg">
                                <span>快捷导航的数据库护肤的空间撒</span>
                            </div>  
                            <div class="x-price">￥5555</div>
                            <div class="x-num">
                                <span class="reduce">-</span>
                                <span class="num">555</span>
                                <span class="add">+</span>
                            </div>
                            <div class="x-sum">￥8888</div>
                            <div class="x-active">
                                <i></i>
                                <span>删除</span>
                            </div>
                        </li> -->
                        <!-- <li>
                            <div class="x-name">
                                <img src="../images/3.jpg">
                                <span>快捷导航的数据库护肤的空间撒</span>
                            </div>
                            <div class="x-price">￥5555</div>
                            <div class="x-num">
                                <span class="reduce">-</span>
                                <span class="num">555</span>
                                <span class="add">+</span>
                                </div>
                            <div class="x-sum">￥8888</div>
                            <div class="x-active">
                                <i></i>
                                <span>删除</span>
                            </div>
                        </li> -->
                    </ul>
                    <div class="endpay">
                        <div class="emdpay-left">
                            <span class="left-name">总价(免运费)：</span>
                            <span class="left-val"></span>
                        </div>
                        <div class="endpay-right">
                            <span class="right-val">立即结算</span>
                            <span class="right-name">继续购物</span>
                        </div>
                    </div>
                    <div class="promise">
                        <div class="promise1">
                            <i></i>
                            <span>官方正品保证</span>
                        </div>
                        <div class="promise2">
                            <i></i>
                            <span>全场免运费</span>
                        </div>
                        <div class="promise3">
                            <i></i>
                            <span>支付保障</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-box">
            <footer>
                <ul>
                    <li>
                        <a href="#">美容常见问题</a>
                    </li>
                    <li>
                        <a href="#">网站常见问题</a>
                    </li>
                    <li>
                        <a href="#">免责：隐私权保护</a>
                    </li>
                    <li>
                        <a href="#">联系我们</a>
                    </li>
                    <li>
                        <a href="#">服务条款</a>
                    </li>
                </ul>
                <span class="share">分享网站到</span>
                <a href="#"><i></i></a>
                <div class="footer-content">
                    <p>
                        Copyright(c) 2015资生堂(中国)投资有限公司；Shiseido China Co., Ltd. All rights reserved
                    </p>
                    <p>
                        沪ICP备10203872号-1 企业营业执照 SHISEIDO资生堂官方网站暨网上商城 全国咨询热线：400-821-6076
                    </p>
                    <p>
                        专柜以及促销信息查询→全国免费咨询热线： 800-820-1010
                    </p>
                    <p class="p4">
                        <i></i>
                        沪公网安备 31011502007430号
                    </p>
                </div>
            </footer>
        </div>
    </div>
</body>
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/function.js"></script>
<script src="../js/common.js"></script>
<script src="../js/wrap.js"></script>
<script>
    //点击注册登录跳转
    $(".usermsg a").click(function(){
        window.location.href = "login.html";
    })
    //取cookie做登录名
    var userLoginId = getCookie("userLoginId");
    var username = getCookie("username");
    if(userLoginId){
        $(".usermsg a").html("欢迎"+username);
        $(".usermsg").append($("<span>退出</span>"));
        $(".usermsg span").click(function(){
            setCookie("userLoginId",userLoginId,-10);
            setCookie("username",username,-10);
            $(this).remove();
            $(".usermsg a").html("登录/注册");
            window.location.href = "login.html";
        })
        $(".usermsg a").append($("<a href='personal.html'>个人中心</a>"));
    }else{
        $(".usermsg a").html("登录/注册");
    }
    //点击进入购物车
    if(userLoginId){
        $(".header-right .header-car").click(function(){
            window.location.href = "payforgoods.html";
            })
    }else{
        wrapBox.init({
            width:300,
            height:70,
            headerTip:"提示",
            headerContent:`您还没有登录,是否立即登录`,
            cancelContent:{
                html:"是个游客",
                fn: function () {
                //更新数据库数据
                }
            },
            confirmContent:{
                html:"立即登录",
                    fn: function () {
                        window.location.href = "login.html"
                    }
                }
        })
    }
    //显示购物车件数
    getTotalNum();
    function getTotalNum(){
        if(userLoginId){
            $.ajax({
                type:"get",
                url:"../php/getnumincar.php",
                data:{
                    userLoginId:userLoginId
                },
                dataType:"json",
                success:function(result){
                    $(".header-car span").html(result["num"] + "件商品");
                }
            })
        }else{
            $(".header-car span").html("请登录");
        }
    }
//数据库数据处理 购物车数据动态生成
getData();
function getData(){
    $.ajax({
        type:"get",
        url:"../php/shoppingcarlist.php",
        data:{
            userLoginId:userLoginId
        },
        dataType:"json",
        success:function(result){
            let html = "";
            $(".table .tbody")[0].innerHTML = "";
            result.map(function(item){
                let id = item["id"];
                let goodsimg = item["goodsimg"];
                let goodsnum = item["goodsnum"];
                let goodsname = item["goodsname"];
                let goodsprice = item["goodsprice"];
                html += `
                        <li>
                            <div class="x-name">
                                <img src="../images/${goodsimg}">
                                <span>${goodsname}</span>
                            </div>
                            <div class="x-price">￥${goodsprice}</div>
                            <div class="x-num">
                                <span class="reduce" onclick="reduce(${id},this)">${goodsnum > 1 ? "-" : ""}</span>
                                <span class="num">${goodsnum}</span>
                                <span class="add" onclick="add(${id},this)">+</span>
                            </div>
                            <div class="x-sum">￥${(goodsnum*goodsprice).toFixed(2)}</div>
                            <div class="x-active">
                                <i></i>
                                <span onclick="del(${id},this)">删除</span>
                            </div>
                        </li>
                    `;
            })
            $(".table .tbody").append(html);
            //总费用
            var sum = 0;
            var sumList = document.querySelectorAll(".x-sum");
            for(let i = 0 ;i<sumList.length;i++){
                let item = sumList[i];
                let length = item.length;
                sum += (item.innerHTML.slice(1,length))*1;
            }
            var box = document.querySelector(".left-val");
            box.innerHTML = "￥" + sum;
        }
    })
}
//减号事件
function reduce(id,ele){
    var currentNum = $(ele).next().html();
    if(currentNum == 1){
        $(this)[0].onclick = null;
        $(this)[0].innerHTML = "";
    }else{
        currentNum = currentNum - 1;

        $(this).next().html(currentNum);
    }
    $.ajax({
        type:"get",
        url:"../php/updatenum.php",
        data:{
            id:id,
            goodsnum:currentNum
        },
        dataType:"json",
        success:function(result){
            if(result["code"] == 0){
                // wrapBox.init({
                //     width:300,
                //     height:70,
                //     headerTip:"提示",
                //     headerContent:`数据更新失败`
                // })
            }
        }
    })
    getData();
    getTotalNum();
}
//加号事件
function add(id,ele){
    var currentNum = $(ele).prev().html();
    // $(ele)[0].innerHTML = "";
    currentNum = currentNum*1 + 1;
    // $(ele).prev().html(currentNum);
    // console.log( $(ele).prev())
    $.ajax({
        type:"get",
        url:"../php/updatenum.php",
        data:{
            id:id,
            goodsnum:currentNum
        },
        dataType:"json",
        success:function(result){
            if(result["code"] == 0){
                wrapBox.init({
                    width:300,
                    height:70,
                    headerTip:"提示",
                    headerContent:`数据更新失败`
                })
            }
        }
    })
    getData();
    getTotalNum();
}
//删除事件
function del(id,ele){
    let par = ele.parentNode.parentNode;
    $.ajax({
        type:"get",
        url:"../php/deletebyid.php",
        data:{
            id:id
        },
        dataType:"json",
        fn: function (result) {
            if(result["code"] == 0){
                par.remove();
            }
        }
    })
    getData();
    getTotalNum();
}
$(".endpay-right .right-name").click(function(){
    window.location.href = "index.html";
})
$(".endpay-right .right-val").click(function(){
    window.location.href = "ordermsg.html";
})
</script>
</html>
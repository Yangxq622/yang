<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>商品详情</title>
    <link href="../css/goods.css" type="text/css" rel="stylesheet">
    <link href="../css/wrap.css" type="text/css" rel="stylesheet">
</head>
<body>
    <div class="box">
        <ul class="banner">
            <li class="banner1">电话咨询
                <div class="banner1-b">
                    <img src="../images/call.png">
                    <span>100-100-100</span>
                </div>
            </li>
            <li class="banner2">关注我们
                <div class="banner2-b">
                    <img src="../images/wx_03.gif">
                </div>
            </li>
            <li class="banner3">在线咨询</li>
            <li class="banner4"><a href="#top">返回顶部</a></li>
        </ul>
        <div class="header-box">
            <header>
                <div class="header-left">
                    <i></i>
                    <span>全场免运费</span>
                </div>
                <div class="header-right">
                    <div class="header-car">
                        <i></i>
                        <span></span>
                    </div>
                    <div class="usermsg">
                        <a href="#">登录/注册</a>
                    </div>
                </div>
            </header>
        </div>
        <div class="middle-box">
            <div class="middle" id="#top">
                <h1>
                    <img src="../images/logo.png">
                </h1>
                <div class="nav">
                    <div class="nav-left">
                               <ul>
                                    <li><a href="index.html">首页</a></li>
                                    <li class="skin"><a href="#">护肤</a>
                                        <div class="menu">
                                            <div class="menu1">
                                                <div class="menu1-top"><span>按系列</span></div>
                                                <ul class="menu1-ul">
                                                    <li>
                                                        <a href="#"><img src="../images/18.png"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/6.png"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/24.png"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/13.jpg"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/14.png"></a>
                                                    </li>
                                                    <li>
                                                       <a href="#"> <img src="../images/25.png"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/22.jpg"></a>
                                                    </li>
                                                    <li>
                                                        <a href="#"><img src="../images/11.jpg"></a>
                                                    </li>
                                                    <li>
                                                       <a href="#"> <img src="../images/1.jpg"></a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="menu2">
                                                <div class="menu2-top"><span>按种类</span></div>
                                                <ul class="menu2-ul">
                                                    <li><a href="#">卸妆清洁</a></li>
                                                    <li><a href="#">爽肤水</a></li>
                                                    <li><a href="#">精华</a></li>
                                                    <li><a href="#">乳液</a></li>
                                                    <li><a href="#">面霜</a></li>
                                                    <li><a href="#">眼唇护理</a></li>
                                                    <li><a href="#">面膜</a></li>
                                                    <li><a href="#">护肤套装</a></li>
                                                </ul>
                                            </div>
                                            <div class="menu3">
                                                <div class="menu3-top"><span>按关心问题</span></div>
                                                <ul class="menu3-ul">
                                                    <li><a href="#">干燥缺水</a></li>
                                                    <li><a href="#">色斑暗沉</a></li>
                                                    <li><a href="#">轻熟肌 弹性流失</a></li>
                                                    <li><a href="#">熟龄肌 深度老化</a></li>
                                                    <li><a href="#">毛孔粗大</a></li>
                                                    <li><a href="#">眼周松弛</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="makeup"><a href="#">彩妆</a>
                                        <div class="make">
                                            <div class="make1">
                                                <div class="make1-top"><span>按系列</span></div>
                                                <ul class="make1-ul">
                                                    <li><a href="#"><img src="../images/9.jpg"></a></li>
                                                    <li><a href="#"><img src="../images/eye.jpg"></a></li>
                                                    <li><a href="#"><img src="../images/17.jpg"></a></li>
                                                    <li><a href="#"><img src="../images/20.jpg"></a></li>
                                                </ul>
                                            </div>
                                            <div class="make2">
                                                <div class="make2-top"><span>面部</span></div>
                                                <ul class="make2-ul">
                                                    <li><a href="#">妆前乳</a></li>
                                                    <li><a href="#">粉底液</a></li>
                                                    <li><a href="#">遮瑕</a></li>
                                                    <li><a href="#">蜜粉</a></li>
                                                    <li><a href="#">腮红</a></li>
                                                </ul>
                                            </div>
                                            <div class="make3">
                                                <div class="make3-top"><span>眼部</span></div>
                                                <ul class="make3-ul">
                                                    <li><a href="#">眼影</a></li>
                                                    <li><a href="#">眼线</a></li>
                                                    <li><a href="#">睫毛膏</a></li>
                                                    <li><a href="#">眉笔</a></li>
                                                </ul>
                                            </div>
                                            <div class="make4">
                                                <div class="make4-top"><span>唇部</span></div>
                                                <ul class="make4-ul">
                                                    <li><a href="#">唇膏</a></li>
                                                    <li><a href="#">唇线</a></li>
                                                </ul>
                                            </div>
                                            <div class="make5">
                                                <div class="make5-top"><span>彩妆其他</span></div>
                                                <ul class="make5-ul">
                                                    <li><a href="#">粉盒</a></li>
                                                    <li><a href="#">刷子</a></li>
                                                    <li><a href="#">工具</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                    <li><a href="#">男士</a></li>
                                    <li><a href="#">防晒</a></li>
                                    <li><a href="#">香氛</a></li>
                                    <li class="nine"><a href="official.html">官网臻享</a></li>
                                    <li class="nine"><a href="famous.html">明星产品</a></li>
                                    <li class="nine"><a href="reason.html">官网购物理由</a></li>
                                    <li class="nine"><a href="#">品牌故事</a></li>
                                    <li class="nine"><a href="#">专柜导航</a></li>
                                </ul>
                    </div>
                    <div class="nav-right">
                                <input type="text" id="search" placeholder="商品搜索">
                                <a href="#"><i></i></a>
                    </div>
                </div>
                <div class="content">
                    <div class="content-left">
                        <div class="li1">
                            <input type="checkbox" id="a" hidden>
                            <label for="a">按种类</label>
                            <ul class="type">
                                <li>卸妆清洁</li>
                                <li>爽肤水</li>
                                <li>精华</li>
                                <li>乳液</li>
                                <li>面霜</li>
                                <li>眼唇护理</li>
                                <li>面膜</li>
                                <li>护肤套装</li>
                            </ul>
                        </div>
                        <div class="li2">
                        <input type="checkbox" id="b" hidden>
                            <label for="b">按系列</label>
                                <ul class="series">
                                <li>红妍肌活精华系列</li>
                                <li>时光琉璃御藏系列</li>
                                <li>悦薇珀翡系列</li>
                                <li>盼丽风姿系列</li>
                                <li>新透美白肌</li>
                                <li>青春日和系列</li>
                                <li>百优系列</li>
                                <li>红色蜜露</li>
                                <li>亲肤系列</li>
                            </ul>
                        </div>
                        <div class="li3">
                            <input type="checkbox" id="c" hidden>
                            <label for="c">按关心问题</label>
                            <ul class="care-point">
                                <li>干燥 缺水</li>
                                <li>色斑 暗沉</li>
                                <li>轻熟肌 弹性流失</li>
                                <li>熟龄肌 深度老化</li>
                                <li>毛孔粗大</li>
                                <li>眼周松弛</li>
                            </ul>
                        </div>
                    </div>
                    <div class="content-right">
                        <div class="left">
                            
                        </div>
                        <div class="right">
                            <h3></h3>
                            <div class="right-i">
                                <i></i>
                                <span>分享</span>
                            </div>
                            <span class="big">30ml</span>
                            <div class="intro">
                                <span></span>
                            </div>
                            <div class="num">
                                <span class="num-name">数量</span>
                                <div class="acti">
                                    <span class="reduce">-</span>
                                    <span class="x-num">1</span>
                                    <span class="add">+</span>
                                </div>
                            </div>
                            <div class="price">
                                <!-- <span class="price-name">价格</span>
                                <span class="price1">54645</span> -->
                            </div>
                            <div class="avtive">
                                <span class="av1">加入购物车</span>
                                <span class="av2">立即购买</span>
                            </div>  
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/common.js"></script>
<script src="../js/function.js"></script>
<script src="../js/wrap.js"></script>
<script>
    var goodsid = location.search.split("=")[1];
    $.ajax({
      type:"get",
      url:"../php/databygoodsid.php",
      data:{
          goodsid:goodsid
      },
      dataType:"json",
      success:function(result){
          $(".right h3").html(result["goodsname"]);
          $(".big").html(result["goodsbig"]);
          $(".intro").html(result["goodsintro"]);
        //动态改变图片  
            var bigImg = document.createElement("img");
            bigImg.src = `../images/${result["goodsimg"]}`;
            $(".left").append(bigImg);
      }  
    })
     //点击注册登录跳转
     $(".usermsg a").click(function(){
        window.location.href = "login.html";
    })
    //取cookie做登录名
    var userLoginId = getCookie("userLoginId");
    var username = getCookie("username");
    if(userLoginId){
        $(".usermsg a").html("欢迎"+username);
        $(".usermsg").append($("<span>退出</span>"));
        $(".usermsg span").click(function(){
            setCookie("userLoginId",userLoginId,-10);
            setCookie("username",username,-10);
            $(this).remove();
            $(".usermsg a").html("登录/注册");
            window.location.href = "login.html";
        })
        $(".usermsg a").append($("<a href='personal.html'>个人中心</a>"));
    }else{
        $(".usermsg a").html("登录/注册");
    }
    //点击进入购物车
    if(userLoginId){
        $(".header-right .header-car").click(function(){
            window.location.href = "payforgoods.html";
            })
    }
    //显示购物车件数
if(userLoginId){
    $.ajax({
        type:"get",
        url:"../php/getnumincar.php",
        data:{
            userLoginId:userLoginId
        },
        dataType:"json",
        success:function(result){
            $(".header-car span").html(result["num"] + "件商品");
        }
    })
}else{
    $(".header-car span").html("请登录");
}
var num = 1;
$(".acti .add").click(function(){
    num ++;
    $(this).siblings(".x-num").html(num);
    $(this).siblings(".reduce").html("-");
})
$(".acti .reduce").click(function(){
    if(num <= 0){
        $(this)[0].onclick = null;
        $(this)[0].innerHTML = "";
    }else{
        num -- ;
        $(this).html("-");
        $(this).siblings(".x-num").html(num);
    }
})
//点击加入购物车
$(".avtive .av1").click(function(){
    var num = $(".num .x-num").html();
    var goodsname = $(this).parent().siblings("h3").html();
    if(userLoginId){
        $.ajax({
        type:"get",
        url:"../php/goodsname.php",
        data:{
            goodsname:goodsname
        },
        dataType:"json",
        success:function(result){
            let goodsid = result["goodsid"];
            let goodsprice = result["goodsprice"];
            let goodsimg = result["goodsimg"];
            $.ajax({
                type:"get",
                url:"../php/addgoods.php",
                data:{
                    userLoginId:userLoginId,
                    goodsid:goodsid,
                    goodsname:goodsname,
                    goodsprice:goodsprice,
                    goodsimg:goodsimg,
                    goodsnum:num
                },
                dataType:"json",
                success:function(str){
                    if(str["code"] == 1){   
                                //新增成功
                                wrapBox.init({
                                    width:300,
                                    height:70,
                                    headerTip:"提示",
                                    headerContent:`加入购车成功`,
                                    cancelContent:{
                                        html:"返回页面",
                                        fn: function () {
                                            //更新数据库数据
                                        }
                                    },
                                    confirmContent:{
                                        html:"进入购物车",
                                        fn: function () {
                                            if(userLoginId){
                                                window.location.href = "payforgoods.html"
                                            }else{
                                                
                                            }
                                        }
                                    }
                                });
                            }else{
                            wrapBox.init({
                                width:300,
                                height:70,
                                headerTip:"提示",
                                headerContent:`加入购车失败`
                            }) 
                            }
                            $.ajax({
                                type:"get",
                                url:"../php/getnumincar.php",
                                data:{
                                    userLoginId:userLoginId
                                },
                                dataType:"json",
                                success:function(result){
                                    $(".header-car span").html(result["num"] + "件商品");
                                }
                            })
                           
                }
            })
        }
    })
    }else{
        wrapBox.init({
            width:300,
            height:70,
            headerTip:"提示",
            headerContent:`您还没有登录,是否立即登录`,
            cancelContent:{
                html:"是个游客",
                fn: function () {
                //更新数据库数据
                }
            },
            confirmContent:{
                html:"立即登录",
                    fn: function () {
                        window.location.href = "login.html"
                    }
                }
        })
    }
})
//立即购买
$(".avtive .av2").click(function(){
    var num = 1;
    var goodsname = $(this).parent().siblings("h3").html();
    if(userLoginId){
        $.ajax({
        type:"get",
        url:"../php/goodsname.php",
        data:{
            goodsname:goodsname
        },
        dataType:"json",
        success:function(result){
            let goodsid = result["goodsid"];
            let goodsprice = result["goodsprice"];
            let goodsimg = result["goodsimg"];
            $.ajax({
                type:"get",
                url:"../php/addgoods.php",
                data:{
                    userLoginId:userLoginId,
                    goodsid:goodsid,
                    goodsname:goodsname,
                    goodsprice:goodsprice,
                    goodsimg:goodsimg,
                    goodsnum:num
                },
                dataType:"json",
                success:function(str){
                    if(str["code"] == 1){
                                //新增成功
                                window.location.href = "payforgoods.html";
                            }else{
                            wrapBox.init({
                                width:300,
                                height:70,
                                headerTip:"提示",
                                headerContent:`加入购车失败`
                            }) 
                            }
                }
            })
        }
    })
    }else{
        wrapBox.init({
            width:300,
            height:70,
            headerTip:"提示",
            headerContent:`您还没有登录,是否立即登录`,
            cancelContent:{
                html:"是个游客",
                fn: function () {
                //更新数据库数据
                }
            },
            confirmContent:{
                html:"立即登录",
                    fn: function () {
                        window.location.href = "login.html"
                    }
                }
        })
    }
    
})
</script>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录</title>
    <link href="../css/login.css" type="text/css" rel="stylesheet">
    <link href="../css/wrap.css" type="text/css" rel="stylesheet">
</head>
<body>
    <div class="box">
        <ul class="banner">
            <li class="banner1">电话咨询
                <div class="banner1-b">
                    <img src="../images/call.png">
                    <span>100-100-100</span>
                </div>
            </li>
            <li class="banner2">关注我们
                <div class="banner2-b">
                    <img src="../images/wx_03.gif">
                </div>
            </li>
            <li class="banner3">在线咨询</li>
            <li class="banner4">返回顶部</li>
        </ul>
        <div class="header-box">
            <header>
                <div class="header-left">
                    <i></i>
                    <span>全场免运费</span>
                </div>
                <div class="header-right">
                    <div class="header-car">
                        <i></i>
                        <span>999件商品</span>
                    </div>
                    <div class="usermsg">
                        <a href="#">登录/注册</a>
                    </div>
                </div>
            </header>
        </div>
        <div class="middle-box">
            <div class="middle">
                <h1>
                    <img src="../images/logo.png">
                </h1>
                <div class="nav">
                    <div class="nav-left">
                        <ul>
                            <li><a href="index.html">首页</a></li>
                            <li class="skin"><a href="#">护肤</a>
                                <div class="menu">
                                    <div class="menu1">
                                        <div class="menu1-top"><span>按系列</span></div>
                                            <ul class="menu1-ul">
                                                <li>
                                                    <a href="#"><img src="../images/18.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/6.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/24.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/13.jpg"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/14.png"></a>
                                                </li>
                                                <li>
                                                   <a href="#"> <img src="../images/25.png"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/22.jpg"></a>
                                                </li>
                                                <li>
                                                    <a href="#"><img src="../images/11.jpg"></a>
                                                </li>
                                                <li>
                                                   <a href="#"> <img src="../images/1.jpg"></a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="menu2">
                                            <div class="menu2-top"><span>按种类</span></div>
                                            <ul class="menu2-ul">
                                                <li><a href="#">卸妆清洁</a></li>
                                                <li><a href="#">爽肤水</a></li>
                                                <li><a href="#">精华</a></li>
                                                <li><a href="#">乳液</a></li>
                                                <li><a href="#">面霜</a></li>
                                                <li><a href="#">眼唇护理</a></li>
                                                <li><a href="#">面膜</a></li>
                                                <li><a href="#">护肤套装</a></li>
                                            </ul>
                                        </div>
                                        <div class="menu3">
                                            <div class="menu3-top"><span>按关心问题</span></div>
                                            <ul class="menu3-ul">
                                                <li><a href="#">干燥缺水</a></li>
                                                <li><a href="#">色斑暗沉</a></li>
                                                <li><a href="#">轻熟肌 弹性流失</a></li>
                                                <li><a href="#">熟龄肌 深度老化</a></li>
                                                <li><a href="#">毛孔粗大</a></li>
                                                <li><a href="#">眼周松弛</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                                <li class="makeup"><a href="#">彩妆</a>
                                    <div class="make">
                                        <div class="make1">
                                            <div class="make1-top"><span>按系列</span></div>
                                            <ul class="make1-ul">
                                                <li><a href="#"><img src="../images/9.jpg"></a></li>
                                                <li><a href="#"><img src="../images/eye.jpg"></a></li>
                                                <li><a href="#"><img src="../images/17.jpg"></a></li>
                                                <li><a href="#"><img src="../images/20.jpg"></a></li>
                                            </ul>
                                        </div>
                                        <div class="make2">
                                            <div class="make2-top"><span>面部</span></div>
                                            <ul class="make2-ul">
                                                <li><a href="#">妆前乳</a></li>
                                                <li><a href="#">粉底液</a></li>
                                                <li><a href="#">遮瑕</a></li>
                                                <li><a href="#">蜜粉</a></li>
                                                <li><a href="#">腮红</a></li>
                                            </ul>
                                        </div>
                                        
                                        <div class="make3">
                                            <div class="make3-top"><span>眼部</span></div>
                                            <ul class="make3-ul">
                                                <li><a href="#">眼影</a></li>
                                                <li><a href="#">眼线</a></li>
                                                <li><a href="#">睫毛膏</a></li>
                                                <li><a href="#">眉笔</a></li>
                                            </ul>
                                        </div>
                                        <div class="make4">
                                            <div class="make4-top"><span>唇部</span></div>
                                            <ul class="make4-ul">
                                                <li><a href="#">唇膏</a></li>
                                                <li><a href="#">唇线</a></li>
                                            </ul>
                                        </div>
                                        <div class="make5">
                                            <div class="make5-top"><span>彩妆其他</span></div>
                                            <ul class="make5-ul">
                                                <li><a href="#">粉盒</a></li>
                                                <li><a href="#">刷子</a></li>
                                                <li><a href="#">工具</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                                <li><a href="#">男士</a></li>
                                <li><a href="#">防晒</a></li>
                                <li><a href="#">香氛</a></li>
                                <li class="nine"><a href="official.html">官网臻享</a></li>
                                <li class="nine"><a href="famous.html">明星产品</a></li>
                                <li class="nine"><a href="reason.html">官网购物理由</a></li>
                                <li class="nine"><a href="#">品牌故事</a></li>
                                <li class="nine"><a href="#">专柜导航</a></li>
                        </ul>
                    </div>
                    <div class="nav-right">
                        <input type="text" id="search" placeholder="商品搜索">
                        <a href="#"><i></i></a>
                    </div>
                </div>
                <ul class="pro">
                    <li>
                        <img src="../images/login1 (1).png">
                        <i class="i1"></i>
                    </li>
                    <li>
                        <img src="../images/login1 (2).png">
                        <i class="i2"></i>
                    </li>
                    <li>
                        <img src="../images/login1 (3).png">
                        <i class="i3"></i>
                    </li>
                    <li>
                        <img src="../images/login1 (4).png">
                        <i class="i4"></i>
                    </li>
                    <li>
                        <img src="../images/login1 (5).png">
                        <i class="i5"></i>
                    </li>
                </ul>
                <div class="userblock">
                    <div class="login">
                        <h3>已经是会员</h3>
                        <h4>马上登录获得更多会员资讯</h4>
                        <input type="text" placeholder="手机号码/电子邮箱" id="login-msg">
                        <span class="login-msg-span"></span>
                        <input id="login-pwd" type="password" placeholder="密码">
                        <span class="login-pwd-span"></span>
                        <a href="#">忘记密码？</a>
                        <div class="protect">
                            <input type="checkbox">
                            我已阅读并接受隐私保护协议
                        </div>
                        <button>登录</button>
                    </div>
                    <div class="register">
                        <h3>加入会员</h3>
                        <h4>成为资生堂花庄会员，体验各种为您量身定制的奢享礼遇</h4>
                        <input type="text" placeholder="电子邮箱" id="register-msg">
                        <span class="register-msg-span"></span>
                        <input type="pwssword" placeholder="密码" id="register-pwd">
                        <span class="password-span"></span>
                        <span class="pwd-tip">密码必须是6位以上字母和数字组成，可以包含符号</span>
                        <div class="check">
                            <input type="checkbox" class="checkpwd">
                            <span  class="look">查看密码</span>
                        </div>
                        <div class="pic">
                            <input id="pic-check" placeholder="图形验证码">
                            <span class="pic-span"></span>
                            <div class="show-pic">验证码</div>
                            <span class="change">看不清楚？换一个</span>
                        </div>
                        <input id="usertel" placeholder="手机">
                        <span class="usertel-span"></span>
                        <div class="tel">
                            <input id="tel-code" placeholder="验证码">
                            <span class="tel-code-span"></span>
                            <span class="clickSpan">发送验证码</span>
                        </div>
                        <input id="username" placeholder="姓名为2-4个汉字或3-16个字母">
                        <span class="username-span"></span>
                        <div class="sure">
                            <input type="checkbox">
                            我已阅读并接受隐私保护协议
                        </div>
                        <button>注册</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-box">
            <footer>
                <ul>
                    <li>
                        <a href="#">美容常见问题</a>
                    </li>
                    <li>
                        <a href="#">网站常见问题</a>
                    </li>
                    <li>
                        <a href="#">免责：隐私权保护</a>
                    </li>
                    <li>
                        <a href="#">联系我们</a>
                    </li>
                    <li>
                        <a href="#">服务条款</a>
                    </li>
                </ul>
                <span class="share">分享网站到</span>
                <a href="#"><i></i></a>
                <div class="footer-content">
                    <p>
                        Copyright(c) 2015资生堂(中国)投资有限公司；Shiseido China Co., Ltd. All rights reserved
                    </p>
                    <p>
                        沪ICP备10203872号-1 企业营业执照 SHISEIDO资生堂官方网站暨网上商城 全国咨询热线：400-821-6076
                    </p>
                    <p>
                        专柜以及促销信息查询→全国免费咨询热线： 800-820-1010
                    </p>
                    <p class="p4">
                        <i></i>
                        沪公网安备 31011502007430号
                    </p>
                </div>
            </footer>
        </div>
    </div>
</body>
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/wrap.js"></script>
<script src="../js/function.js"></script>
<script>
    //页面开始刷新验证码
    var str = regStr();
    $(".show-pic").html(randNum(4,str));
    //获取手机验证码
    $(".clickSpan").click(function(){
        var usertel = $("#usertel").val();
        //点击后首先查询手机号是否已经注册
        $.ajax({
            type:"get",
            url:"../php/telquery.php",
            data:{
                usertel:usertel
            },
            dataType:"json",
            success:function(result){
                if(result["code"] == 0){
                    $(".usertel-span").html(result["msg"]);
                }else{
                    //未注册过的手机才能继续操作
                    wrapBox.init({
                        width:300,
                        height:70,
                        headerTip:"提示",
                        headerContent:`验证码已发送至您的手机`
                    });
                    $.ajax({
                        type: "get",
                        url: "../php/miaodi/apiDemo/sendCode.php",
                        data:{
                            userTel:usertel
                        },
                        dataType: "json",
                        success: function (result) {
                                    if(result["code"] == 0){
                                            wrapBox.init({
                                                width:300,
                                                height:70,
                                                headerTip:"提示",
                                                headerContent:`验证码发送失败`
                                            });
                                     }else{
                                        // alert("123");
                                           //成功后点击验证码不可
                                            $(".clickSpan").click = null;
                                            var timer = "";
                                            var num = 5;
                                            timer = setInterval(function () {
                                                $(".clickSpan").html(num);
                                                num --;
                                                if (num == -1){
                                                    clearInterval(timer);
                                                    $(".clickSpan").html("获取验证码");
                                                }
                                            },1000)
                                            }    
                                    }
                    });
                }
            }
        })
        
    });
    //刷新验证码
    $(".change").click(function(){
        $(".show-pic").html(randNum(4,str));
    })
    //给注册点击事件 获取文本框内容进行正则判断并且同意条款
    $(".register button").click(function(){
        var register_msg = $("#register-msg").val();
        var register_pwd = $("#register-pwd").val();
        var register_pwd2 = $("#register-pwd2").val();
        var pic_code = $("#pic-check").val();  //
        var show_pic = $(".show-pic").html();//显示的验证码
        var usertel = $("#usertel").val();
        var tel_code = $("#tel-code").val();
        var username = $("#username").val();
        
        if(!register_msg){
            $(".register-msg-span").html("电子邮箱不能为空");
        }else{
            //正则判断邮箱
            var register_msg_reg = /^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.{1,2}[a-z]+)+$/;
            if(register_msg_reg.test(register_msg)){
                var flag1 = true;
            }else{
                $(".register-msg-span").html("邮箱格式错误");
            }
        }
        if(!register_pwd){
            $(".password-span").html("密码不能为空");
        }else{
            var register_pwd_reg = /^[a-z0-9_-]{6,18}$/;
            if(register_pwd_reg.test(register_pwd)){
                if(register_pwd2 == register_pwd){
                    var flag2 = true;
                }else if(register_pwd2 != register_pwd){
                    $(".password-span").html("两次输入密码不一致");
                }
            }else{
                $(".password-span").html("密码格式错误");
            }
        }
        if(!pic_code || (pic_code != show_pic)){
            $(".pic-span").html("请正确填写图形验证码");
        }
        if(!usertel){
            $(".usertel-span").html("手机号不能为空");
        }else{
            var usertel_reg = /^[1][3-9][0-9]{9}$/g;
            if(usertel_reg.test(usertel)){
               var flag3 = true;
            }else{
                $(".usertel-span").html("手机号格式错误");
            }
        }
        if(!tel_code){
            $(".tel-code-span").html("验证码不能为空");
        }else{
            //填入验证码 去数据库校验是否匹配
            $.ajax({
                type:"get",
                url:"../php/checkphone.php",
                data:{
                    userTel:usertel,
                    telCode:tel_code
                },
                dataType:"json",
                success:function(result){
                    if(result["code"] == 1){
                        //输入一致 检验通过
                        var flag3 = true;
                    }else{
                        $(".usertel-span").html("验证码输入错误");
                    }
                }
            });
        }
        if(!username){
            $(".username-span").html("姓名不能为空");
        }else{
            var username_reg = /^[\u4e00-\u9fa5]{2,4}$/g;
            var username_reg2 = /^[a-z0-9_-]{3,16}$/;
            if(username_reg.test(username) || username_reg2.test(username)){
               var flag4 = true;
            }else{
                // alert("no");
            }
        }
        var flag5 = $(".sure input").prop("checked");
        if(flag5 == false){
            wrapBox.init({
                width:300,
                height:70,
                headerTip:"提示",
                headerContent:`同意后才能继续`
            })
        }
        if(flag1 && flag2 && flag3 && flag4 && flag5){
            $.ajax({
                type:"get",
                url:"../php/register.php",
                data:{
                        email:register_msg,
                        userpwd:register_pwd,
                        code:tel_code,
                        usertel:usertel,
                        username:username
                },
                dataType:"json",
                success:function(result){
                    if(result["code"] == 1){
                        wrapBox.init({
                                         width:300,
                                        height:70,
                                        headerTip:"提示",
                                        headerContent:`注册成功`
                                    });
                        window.location.href = "login.html";
                    }else{
                        wrapBox.init({
                                         width:300,
                                        height:70,
                                        headerTip:"提示",
                                        headerContent:`注册失败`
                                    });
                    }
                }
            })
        }
    })

    //denglu
    var userLoginId;
    $(".login button").click(function(){
        var login_msg = $("#login-msg").val();
        var login_pwd = $("#login-pwd").val();
        $.ajax({
            type:"get",
            url:"../php/login.php",
            data:{
                usertel:login_msg,
                userpwd:login_pwd
            },
            dataType:"json",
            success:function(result){
                var flag = $(".protect input").prop("checked");
                if(flag){
                    if(result["code"] == 0){
                        $(".login-pwd-span").html(result["msg"]);
                    }else if(result["code"] == 2){
                        $(".login-msg-span").html(result["msg"]);
                    }else if(result["code"] == 1){
                        wrapBox.init({
                            width:300,
                            height:70,
                            headerTip:"提示",
                            headerContent:`登录成功`
                        });
                        var userLoginId = result["userid"];
                        var username = result["username"];
                        setCookie("userLoginId",userLoginId,7);//存ID
                        setCookie("username",username,7);//存用户名
                        window.location.href = "index.html"
                        userLoginId = getCookie("userLoginId");
                    }   
                }else{
                    wrapBox.init({
                            width:300,
                           height:70,
                            headerTip:"提示",
                            headerContent:`您需要同意条款才能登录`
                        });
                }
            }
        })
    })
     //显示购物车件数
     if(userLoginId){
        $.ajax({
            type:"get",
            url:"../php/getnumincar.php",
            data:{
                userLoginId:userLoginId
            },
            dataType:"json",
            success:function(result){
                $(".header-car span").html(result["num"] + "件商品");
            }
        })
    }else{
        $(".header-car span").html("请登录");
    }
</script>
</html>